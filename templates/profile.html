<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>üîÆ –ö–ª—É–± –í–µ–¥—å–º</h1>
            <p class="subtitle">"–ü–æ –ú—ë—Ç–ª–∞–º"</p>
        </header>

        <nav class="app-nav">
            <a href="/" class="nav-item">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">–£—á–∞—Å—Ç–Ω–∏—Ü—ã</span>
            </a>
            <a href="/survey" class="nav-item">
                <span class="nav-icon">üìù</span>
                <span class="nav-text">–ê–Ω–∫–µ—Ç–∞</span>
            </a>
            <a href="/profile" class="nav-item active">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </nav>

        <main class="app-main">
            <section class="profile-section">
                <div id="profileContent"></div>
            </section>
        </main>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        async function loadProfile() {
            try {
                const response = await fetch('/get_profile');
                const data = await response.json();

                if (data.success && data.profile) {
                    const p = data.profile;
                    document.getElementById('profileContent').innerHTML = `
                        <div class="profile-card">
                            <h2>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                            <div class="profile-item">
                                <span class="label">–ò–º—è:</span>
                                <span class="value">${p.name}</span>
                            </div>
                            <div class="profile-item">
                                <span class="label">–í–æ–∑—Ä–∞—Å—Ç:</span>
                                <span class="value">${p.age} –ª–µ—Ç</span>
                            </div>
                            <div class="profile-item">
                                <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                                <span class="value">${p.status === 'married' ? 'üíç –ó–∞–º—É–∂–µ–º' : '‚ú® –°–≤–æ–±–æ–¥–Ω–∞'}</span>
                            </div>
                            <div class="profile-item">
                                <span class="label">–î–µ—Ç–∏:</span>
                                <span class="value">${p.children === 'yes' ? 'üë∂ –î–∞' : '‚ùå –ù–µ—Ç'}</span>
                            </div>
                            <div class="profile-item">
                                <span class="label">–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:</span>
                                <span class="value">${p.topic || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
                            </div>
                            <div class="profile-item">
                                <span class="label">–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
                                <span class="value">${p.source || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
                            </div>
                            <button class="btn-logout" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
                        </div>
                    `;
                } else {
                    document.getElementById('profileContent').innerHTML = `
                        <div class="no-profile">
                            <p>üìù –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω</p>
                            <a href="/survey" class="btn-submit">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É</a>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('profileContent').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')) {
                fetch('/logout').then(() => window.location.href = '/');
            }
        }

        loadProfile();
    </script>
</body>
</html>
