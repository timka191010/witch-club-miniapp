<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å - –ö–ª—É–± –í–µ–¥—å–º</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üîÆ –ö–ª—É–± –í–µ–¥—å–º "–ü–æ –ú—ë—Ç–ª–∞–º"</h1>
            <p class="subtitle">–ó–∞–∫—Ä—ã—Ç–æ–µ –∂–µ–Ω—Å–∫–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –¥–ª—è –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞</p>
        </header>

        <div class="navigation">
            <a href="/" class="nav-btn">üë• –£—á–∞—Å—Ç–Ω–∏—Ü—ã</a>
            <a href="/survey" class="nav-btn">üìù –ê–Ω–∫–µ—Ç–∞</a>
            <a href="/profile" class="nav-btn active">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>

        <div class="profile-section">
            <h2>‚öôÔ∏è –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
            
            <div class="profile-card">
                <div class="profile-field">
                    <div class="profile-label">–ò–º—è:</div>
                    <div class="profile-value" id="userName">‚Äî</div>
                </div>

                <div class="profile-field">
                    <div class="profile-label">ID:</div>
                    <div class="profile-value" id="userId">‚Äî</div>
                </div>

                <div class="profile-field">
                    <div class="profile-label">–°—Ç–∞—Ç—É—Å –∞–Ω–∫–µ—Ç—ã:</div>
                    <div class="profile-status">
                        <span id="statusText" class="status-pending">‚Äî</span>
                    </div>
                </div>
            </div>

            <div class="profile-info">
                <h3>‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å—ã –∞–Ω–∫–µ—Ç—ã:</h3>
                <ul>
                    <li>‚è≥ <strong>–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</strong> ‚Äî –∞–Ω–∫–µ—Ç–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</li>
                    <li>‚úÖ <strong>–û–¥–æ–±—Ä–µ–Ω–∞</strong> ‚Äî –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª—É–±!</li>
                    <li>‚ùå <strong>–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</strong> ‚Äî –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;
        const userId = user?.id || 0;
        const userName = user?.first_name || user?.username || '‚Äî';

        console.log('Telegram user data:', user);
        console.log('User ID:', userId);
        console.log('User Name:', userName);

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è –∏ ID
        document.getElementById('userName').textContent = userName;
        document.getElementById('userId').textContent = userId || '‚Äî';

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–Ω–∫–µ—Ç—ã
        if (userId) {
            fetch(`/api/user_status/${userId}`)
                .then(res => res.json())
                .then(data => {
                    console.log('Status response:', data);
                    
                    const statusEl = document.getElementById('statusText');
                    
                    if (data.success && data.application) {
                        const status = data.application.status;
                        
                        if (status === 'pending') {
                            statusEl.textContent = '‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏';
                            statusEl.className = 'status-pending';
                        } else if (status === 'approved') {
                            statusEl.textContent = '‚úÖ –û–¥–æ–±—Ä–µ–Ω–∞';
                            statusEl.className = 'status-approved';
                        } else if (status === 'rejected') {
                            statusEl.textContent = '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞';
                            statusEl.className = 'status-rejected';
                        }
                    } else {
                        statusEl.textContent = 'üìù –ê–Ω–∫–µ—Ç–∞ –Ω–µ –ø–æ–¥–∞–Ω–∞';
                        statusEl.className = 'status-pending';
                    }
                })
                .catch(err => {
                    console.error('Error loading status:', err);
                    document.getElementById('statusText').textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                });
        } else {
            document.getElementById('statusText').textContent = 'üì± –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram –±–æ—Ç–µ';
        }
    </script>
</body>
</html>
