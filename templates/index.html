<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∫–µ—Ç–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üîÆ –ö–ª—É–± –í–µ–¥—å–º "–ü–æ –ú—ë—Ç–ª–∞–º"</h1>
            <p class="subtitle">–ó–∞–∫—Ä—ã—Ç–æ–µ –∂–µ–Ω—Å–∫–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</p>
        </header>

        <div class="navigation">
            <a href="/" class="nav-btn">üë• –£—á–∞—Å—Ç–Ω–∏—Ü—ã</a>
            <a href="/survey" class="nav-btn active">üìù –ê–Ω–∫–µ—Ç–∞</a>
            <a href="/profile" class="nav-btn">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>

        <div class="form-section">
            <h2>üìù –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É</h2>
            <form id="applicationForm" class="application-form">
                <div class="form-group">
                    <label>–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" name="name" required placeholder="–ú–∞—Ä–∏—è">
                </div>

                <div class="form-group">
                    <label>–í–æ–∑—Ä–∞—Å—Ç:</label>
                    <input type="number" name="age" required placeholder="30" min="18" max="100">
                </div>

                <div class="form-group">
                    <label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                    <input type="text" name="family_status" required placeholder="–ó–∞–º—É–∂–µ–º / –ù–µ –∑–∞–º—É–∂–µ–º">
                </div>

                <div class="form-group">
                    <label>–ï—Å—Ç—å –ª–∏ –¥–µ—Ç–∏? –°–∫–æ–ª—å–∫–æ?</label>
                    <input type="text" name="children" required placeholder="2 —Ä–µ–±—ë–Ω–∫–∞ / –ù–µ—Ç">
                </div>

                <div class="form-group">
                    <label>–£–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ö–æ–±–±–∏:</label>
                    <textarea name="hobbies" required rows="3" placeholder="–ô–æ–≥–∞, —á—Ç–µ–Ω–∏–µ..."></textarea>
                </div>

                <div class="form-group">
                    <label>–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ç–µ–º—ã:</label>
                    <textarea name="themes" required rows="3" placeholder="–≠–∑–æ—Ç–µ—Ä–∏–∫–∞, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è..."></textarea>
                </div>

                <div class="form-group">
                    <label>–¶–µ–ª—å –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è:</label>
                    <textarea name="goal" required rows="4" placeholder="–ù–∞–π—Ç–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏—Ü..."></textarea>
                </div>

                <div class="form-group">
                    <label>–û—Ç–∫—É–¥–∞ —É–∑–Ω–∞–ª–∏ –æ –∫–ª—É–±–µ?</label>
                    <input type="text" name="source" required placeholder="–û—Ç –ø–æ–¥—Ä—É–≥–∏ / –°–æ—Ü—Å–µ—Ç–∏">
                </div>

                <button type="submit" class="submit-btn">‚ú® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É</button>
            </form>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        document.getElementById('applicationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fd = new FormData(e.target);
            const user = tg.initDataUnsafe?.user;
            
            const data = {
                user_id: user?.id || Math.floor(Math.random() * 1000000),
                name: fd.get('name'),
                age: fd.get('age'),
                family_status: fd.get('family_status'),
                children: fd.get('children'),
                hobbies: fd.get('hobbies'),
                themes: fd.get('themes'),
                goal: fd.get('goal'),
                source: fd.get('source')
            };

            try {
                const res = await fetch('/submit', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                const json = await res.json();
                
                if (json.success) {
                    tg.showAlert('‚úÖ –ê–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                    setTimeout(() => window.location.href = '/profile', 1000);
                } else {
                    tg.showAlert(json.message);
                }
            } catch (err) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
            }
        });
    </script>
</body>
</html>
